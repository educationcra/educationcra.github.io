<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CRA Job Fair 2026 Dashboard - Full Data</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Noto Sans Thai', sans-serif; }
    .card { @apply bg-white p-6 rounded-2xl shadow-sm border border-gray-100; }
    .loader { border: 4px solid #f3f3f3; border-top: 4px solid #0F2C67; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body class="bg-slate-50 text-slate-800 antialiased">

  <div id="loading" class="fixed inset-0 bg-white/95 z-50 flex flex-col items-center justify-center">
    <div class="loader mb-4"></div>
    <p class="text-blue-900 font-bold">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£ CRA 2026...</p>
  </div>

  <div id="app" class="container mx-auto px-4 py-8 max-w-7xl opacity-0 transition-opacity duration-500">
    <header class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4 border-b pb-6">
      <div>
        <h1 class="text-3xl font-bold text-blue-900">CRA Job Fair & Education 2026</h1>
        <p class="text-gray-500">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à</p>
      </div>
      
      <div class="flex items-center gap-3 bg-white p-2 rounded-xl border shadow-sm">
        <span class="text-sm font-bold ml-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</span>
        <select id="dateFilter" onchange="renderDashboard()" class="bg-gray-50 border-none text-blue-900 font-bold rounded-lg focus:ring-0">
          <option value="ALL">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (12-13 ‡∏Å.‡∏û.)</option>
          <option value="12.02.69">‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 12 ‡∏Å.‡∏û. 69</option>
          <option value="13.02.69">‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 13 ‡∏Å.‡∏û. 69</option>
        </select>
      </div>
    </header>

    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
      <div class="card text-center">
        <p class="text-gray-500 text-xs uppercase font-bold mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</p>
        <p class="text-4xl font-bold text-blue-900" id="statTotal">0</p>
      </div>
      <div class="card text-center border-l-4 border-l-blue-900">
        <p class="text-gray-500 text-xs uppercase font-bold mb-1">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à‡∏£‡∏ß‡∏° (T)</p>
        <p class="text-4xl font-bold text-blue-900" id="statAvg">0.00</p>
      </div>
      <div class="card text-center">
        <p class="text-gray-500 text-xs uppercase font-bold mb-1">‡∏™‡∏ô‡πÉ‡∏à‡∏£‡πà‡∏ß‡∏°‡∏õ‡∏µ‡∏´‡∏ô‡πâ‡∏≤ (U)</p>
        <p class="text-4xl font-bold text-green-600" id="statNextYear">0%</p>
      </div>
      <div class="card text-center">
        <p class="text-gray-500 text-xs uppercase font-bold mb-1">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà (P)</p>
        <p class="text-4xl font-bold text-orange-600" id="statVenue">0.00</p>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
      <div class="card"><h3 class="font-bold mb-4 text-sm border-b pb-2">‡πÄ‡∏û‡∏® (B)</h3><div class="h-60"><canvas id="chartGender"></canvas></div></div>
      <div class="card"><h3 class="font-bold mb-4 text-sm border-b pb-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô (C)</h3><div class="h-60"><canvas id="chartType"></canvas></div></div>
      <div class="card"><h3 class="font-bold mb-4 text-sm border-b pb-2">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (E)</h3><div class="h-60"><canvas id="chartDegree"></canvas></div></div>
    </div>

    <div class="card mb-8">
      <h3 class="font-bold mb-6 text-blue-900">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏á‡∏≤‡∏ô (‡πÄ‡∏ï‡πá‡∏° 5)</h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <div id="scoreQ"></div>
        <div id="scoreR"></div>
        <div id="scoreS"></div>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
      <div class="card">
        <h3 class="font-bold mb-4">‡πÅ‡∏´‡∏•‡πà‡∏á‡∏£‡∏±‡∏ö‡∏£‡∏π‡πâ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£ (W)</h3>
        <div id="sourceTable" class="text-sm"></div>
      </div>
      <div class="card">
        <h3 class="font-bold mb-4 text-center">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤ (V)</h3>
        <div class="h-60"><canvas id="chartMonth"></canvas></div>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
      <div class="card">
        <h3 class="font-bold mb-4 text-blue-900">‡∏™‡∏ñ‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</h3>
        <div id="companyTable" class="overflow-y-auto max-h-80"></div>
      </div>
      <div class="card">
        <h3 class="font-bold mb-4 text-orange-600">‡∏ö‡∏π‡∏ò‡∏™‡∏õ‡∏≠‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ä‡∏∑‡πà‡∏ô‡∏ä‡∏≠‡∏ö</h3>
        <div id="sponsorTable" class="overflow-y-auto max-h-80"></div>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="card bg-blue-50">
        <h3 class="font-bold mb-4 text-blue-900">‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡∏°‡∏≤‡∏õ‡∏µ‡∏´‡∏ô‡πâ‡∏≤ (AB, AG)</h3>
        <div id="wantedList" class="text-sm space-y-2 max-h-60 overflow-y-auto"></div>
      </div>
      <div class="card bg-orange-50">
        <h3 class="font-bold mb-4 text-orange-900">‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (AC, AH)</h3>
        <div id="suggestList" class="text-sm space-y-2 max-h-60 overflow-y-auto"></div>
      </div>
    </div>
  </div>

  <script>
    const GAS_URL = 'https://script.google.com/macros/s/AKfycbylyonLUKe_jJjbrtTASPg9Rphi7Ln9vRU2mO7Q6l-QcZ3p2htU_5NLUxIi2khhoa8s/exec?type=json';
    let RAW_DATA = [];
    let charts = {};

    window.onload = async () => {
      try {
        const resp = await fetch(GAS_URL);
        RAW_DATA = await resp.json();
        renderDashboard();
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('app').classList.remove('opacity-0');
      } catch (e) {
        alert("Error: " + e.message);
      }
    };

    function renderDashboard() {
      const filterDate = document.getElementById('dateFilter').value;
      // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå X (Index 23)
      const data = filterDate === "ALL" ? RAW_DATA : RAW_DATA.filter(r => r[23].includes(filterDate));
      
      // Update KPIs
      document.getElementById('statTotal').innerText = data.length;
      document.getElementById('statAvg').innerText = calcAvg(data, 19);
      document.getElementById('statVenue').innerText = calcAvg(data, 15);
      
      const nextYear = getCounts(data, 20);
      const yesPct = ((nextYear.find(x => x[0].includes("‡∏™‡∏ô‡πÉ‡∏à"))?.[1] || 0) / data.length * 100).toFixed(0);
      document.getElementById('statNextYear').innerText = yesPct + "%";

      // Render Charts
      updateChart('chartGender', 'pie', getCounts(data, 1));
      updateChart('chartType', 'bar', getCounts(data, 2));
      updateChart('chartDegree', 'doughnut', getCounts(data, 4));
      updateChart('chartMonth', 'bar', getCounts(data, 21));

      // Render Scores (Q, R, S)
      renderScoreBar('scoreQ', '‡∏ä‡πà‡∏ß‡∏á‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£ (Q)', calcAvg(data, 16));
      renderScoreBar('scoreR', '‡∏ä‡πà‡∏ß‡∏á‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó (R)', calcAvg(data, 17));
      renderScoreBar('scoreS', '‡∏ä‡πà‡∏ß‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ö‡∏ô‡πÄ‡∏ß‡∏ó‡∏µ (S)', calcAvg(data, 18));

      // Render Tables
      renderTable('sourceTable', getCounts(data, 22, true), ['‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á', '‡∏Ñ‡∏ô']);
      
      // Combine Companies (Y, Z, AD, AE)
      const compCounts = getCombinedCounts(data, [24, 25, 29, 30]);
      renderTable('companyTable', compCounts, ['‡∏™‡∏ñ‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à']);

      // Combine Sponsors (AA, AF)
      const sponCounts = getCombinedCounts(data, [26, 31]);
      renderTable('sponsorTable', sponCounts, ['‡∏ö‡∏π‡∏ò‡∏™‡∏õ‡∏≠‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå', '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÇ‡∏´‡∏ß‡∏ï']);

      // Text Lists
      renderTextList('wantedList', data, [27, 32]);
      renderTextList('suggestList', data, [28, 33]);
    }

    function calcAvg(data, idx) {
      const vals = data.map(r => parseFloat(r[idx])).filter(v => !isNaN(v));
      return vals.length ? (vals.reduce((a,b)=>a+b, 0)/vals.length).toFixed(2) : "0.00";
    }

    function getCounts(data, idx, isMulti = false) {
      let c = {};
      data.forEach(r => {
        let items = isMulti ? (r[idx]||"").split(/,\s*/) : [r[idx]];
        items.forEach(it => { if(it && it.trim() !== "" && it !== "-") c[it] = (c[it]||0)+1; });
      });
      return Object.entries(c).sort((a,b) => b[1]-a[1]);
    }

    function getCombinedCounts(data, indices) {
      let c = {};
      data.forEach(r => {
        indices.forEach(idx => {
          let val = r[idx]?.trim();
          if(val && val !== "" && val !== "-") c[val] = (c[val]||0)+1;
        });
      });
      return Object.entries(c).sort((a,b) => b[1]-a[1]).slice(0, 15);
    }

    function renderScoreBar(id, label, score) {
      const pct = (score/5*100).toFixed(0);
      document.getElementById(id).innerHTML = `
        <div class="text-sm font-bold mb-1">${label}</div>
        <div class="flex items-center gap-3">
          <div class="flex-1 bg-gray-100 h-4 rounded-full overflow-hidden">
            <div class="bg-blue-600 h-full" style="width:${pct}%"></div>
          </div>
          <span class="font-bold text-blue-900">${score}</span>
        </div>`;
    }

    function renderTable(id, counts, headers) {
      document.getElementById(id).innerHTML = `
        <table class="w-full text-left">
          <thead><tr class="text-gray-400 border-b"><th>${headers[0]}</th><th class="text-right">${headers[1]}</th></tr></thead>
          <tbody>${counts.map(c => `<tr class="border-b"><td class="py-2">${c[0]}</td><td class="text-right font-bold">${c[1]}</td></tr>`).join('')}</tbody>
        </table>`;
    }

    function renderTextList(id, data, indices) {
      let items = [];
      data.forEach(r => indices.forEach(idx => { if(r[idx] && r[idx].length > 2) items.push(r[idx]); }));
      document.getElementById(id).innerHTML = items.length ? items.map(t => `<div class="p-2 bg-white rounded border border-gray-100 shadow-sm">üí¨ ${t}</div>`).join('') : "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°";
    }

    function updateChart(id, type, counts) {
      if(charts[id]) charts[id].destroy();
      charts[id] = new Chart(document.getElementById(id), {
        type: type,
        data: {
          labels: counts.map(c => c[0]),
          datasets: [{ data: counts.map(c => c[1]), backgroundColor: ['#0F2C67','#E65100','#3b82f6','#10b981','#f59e0b','#94a3b8'] }]
        },
        options: { maintainAspectRatio: false, plugins: { legend: { display: type !== 'bar', position: 'bottom' } } }
      });
    }
  </script>
</body>
</html>
