<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CRA Job Fair 2026 - Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
  <script>
    tailwind.config = {
      theme: { extend: { colors: { cra: { navy: '#0F2C67', orange: '#E65100' } } } }
    }
  </script>
  <style>
    body { font-family: 'Noto Sans Thai', sans-serif; background: #f8fafc; }
    .loader { border: 4px solid #f3f3f3; border-top: 4px solid #0F2C67; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .card-stat { @apply bg-white p-6 rounded-3xl shadow-sm border border-slate-100 transition-all hover:shadow-md; }
  </style>
</head>
<body class="text-slate-800 antialiased">

  <div id="loading" class="fixed inset-0 bg-white/95 z-[100] flex flex-col items-center justify-center">
    <div class="loader mb-4"></div>
    <p class="text-cra-navy font-bold animate-pulse">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥...</p>
  </div>

  <div id="app" class="max-w-7xl mx-auto px-4 py-8 opacity-0 transition-opacity duration-1000">
    <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-6 border-b pb-8">
      <div>
        <h1 class="text-3xl font-black text-cra-navy tracking-tight">CRA JOB FAIR & EDUCATION 2026</h1>
        <p class="text-slate-500 font-medium">Analytics & Performance Dashboard</p>
      </div>
      
      <div class="flex items-center gap-4 bg-white p-2 rounded-2xl shadow-sm border">
        <label class="text-xs font-bold text-slate-400 px-2 uppercase">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
        <select id="dateSelect" onchange="updateUI()" class="bg-slate-50 border-none font-bold text-cra-navy focus:ring-0 rounded-xl cursor-pointer">
          <option value="ALL">‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (12-13 ‡∏Å.‡∏û.)</option>
          <option value="12.02.69">12 ‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå 2569</option>
          <option value="13.02.69">13 ‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå 2569</option>
        </select>
        <button onclick="window.print()" class="bg-cra-navy text-white px-4 py-2 rounded-xl font-bold text-sm hover:opacity-90">‡∏û‡∏¥‡∏°‡∏û‡πå‡∏™‡∏£‡∏∏‡∏õ</button>
      </div>
    </header>

    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-10">
      <div class="card-stat">
        <p class="text-slate-400 text-xs font-bold uppercase mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏ï‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
        <div class="flex items-baseline gap-2">
          <span class="text-4xl font-black text-cra-navy" id="totalN">0</span>
          <span class="text-slate-400 font-bold">‡∏Ñ‡∏ô</span>
        </div>
      </div>
      <div class="card-stat border-l-4 border-l-cra-orange">
        <p class="text-slate-400 text-xs font-bold uppercase mb-2">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (T)</p>
        <div class="flex items-baseline gap-2">
          <span class="text-4xl font-black text-cra-orange" id="avgT">0.00</span>
          <span class="text-slate-400 font-bold">/ 5.00</span>
        </div>
      </div>
      <div class="card-stat">
        <p class="text-slate-400 text-xs font-bold uppercase mb-2">‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏ô‡πÉ‡∏à‡∏£‡πà‡∏ß‡∏°‡∏õ‡∏µ‡∏´‡∏ô‡πâ‡∏≤</p>
        <div class="flex items-baseline gap-2">
          <span class="text-4xl font-black text-emerald-600" id="pctU">0</span>
          <span class="text-slate-400 font-bold">%</span>
        </div>
      </div>
      <div class="card-stat">
        <p class="text-slate-400 text-xs font-bold uppercase mb-2">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡πÄ‡∏ß‡∏•‡∏≤ (O)</p>
        <div class="flex items-baseline gap-2">
          <span class="text-4xl font-black text-blue-600" id="avgO">0.00</span>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-3xl p-8 shadow-sm border border-slate-100 mb-10">
      <h3 class="text-lg font-bold text-slate-700 mb-8 flex items-center gap-2">
        <span class="w-2 h-6 bg-cra-navy rounded-full"></span> ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à‡∏£‡∏≤‡∏¢‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢)
      </h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-10" id="scoreBars"></div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-10">
      <div class="bg-white p-8 rounded-3xl border shadow-sm">
        <h3 class="font-bold text-slate-700 mb-6">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ä‡∏°‡∏á‡∏≤‡∏ô (‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞)</h3>
        <div class="h-64"><canvas id="chartType"></canvas></div>
      </div>
      <div class="bg-white p-8 rounded-3xl border shadow-sm">
        <h3 class="font-bold text-slate-700 mb-6">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏£‡∏π‡πâ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£ (W)</h3>
        <div id="tableW"></div>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <div class="bg-white p-8 rounded-3xl border shadow-sm">
        <h3 class="font-bold text-cra-navy mb-6">10 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</h3>
        <div id="tableCompany"></div>
      </div>
      <div class="bg-white p-8 rounded-3xl border shadow-sm">
        <h3 class="font-bold text-cra-orange mb-6">‡∏ö‡∏π‡∏ò‡∏™‡∏õ‡∏≠‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏ó‡∏±‡∏ö‡πÉ‡∏à‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h3>
        <div id="tableSponsor"></div>
      </div>
    </div>

    <div class="mt-10 bg-slate-900 rounded-3xl p-8 text-white">
        <h3 class="text-xl font-bold mb-6 flex items-center gap-2">üí¨ ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</h3>
        <div id="listSuggest" class="grid grid-cols-1 md:grid-cols-2 gap-4 max-h-80 overflow-y-auto pr-4"></div>
    </div>
  </div>

  <script>
    Chart.register(ChartDataLabels);
    const API_URL = '‡πÉ‡∏™‡πà_URL_Web_App_‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì_‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà?type=json';
    let RAW_DATA = [];
    let activeCharts = {};

    window.onload = async () => {
      try {
        const resp = await fetch(API_URL);
        RAW_DATA = await resp.json();
        updateUI();
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('app').classList.remove('opacity-0');
      } catch (e) { alert("Error: " + e.message); }
    };

    function updateUI() {
      const day = document.getElementById('dateSelect').value;
      const data = day === "ALL" ? RAW_DATA : RAW_DATA.filter(r => r[23].includes(day));
      const total = data.length;

      // 1. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì KPIs
      document.getElementById('totalN').innerText = total.toLocaleString();
      document.getElementById('avgT').innerText = getAvg(data, 19);
      document.getElementById('avgO').innerText = getAvg(data, 14);
      
      const uCounts = getCounts(data, 20);
      const interestNext = uCounts.find(x => x[0].includes("‡∏™‡∏ô‡πÉ‡∏à"))?.[1] || 0;
      document.getElementById('pctU').innerText = ((interestNext/total)*100 || 0).toFixed(1);

      // 2. ‡πÅ‡∏ú‡∏ô‡∏†‡∏π‡∏°‡∏¥‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° (‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞)
      renderChart('chartType', 'bar', getCounts(data, 2), total);

      // 3. ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à‡∏£‡∏≤‡∏¢‡∏î‡πâ‡∏≤‡∏ô (Q, R, S)
      const metrics = [
        {idx: 16, label: '‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡∏ú‡∏•‡∏á‡∏≤‡∏ô (Q)'},
        {idx: 17, label: '‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó (R)'},
        {idx: 18, label: '‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ö‡∏ô‡πÄ‡∏ß‡∏ó‡∏µ (S)'}
      ];
      document.getElementById('scoreBars').innerHTML = metrics.map(m => {
        const avg = getAvg(data, m.idx);
        const pct = (avg/5*100).toFixed(0);
        return `<div>
          <div class="flex justify-between mb-2"><span class="text-sm font-bold text-slate-500">${m.label}</span><span class="font-black text-cra-navy">${avg}</span></div>
          <div class="w-full bg-slate-100 h-3 rounded-full overflow-hidden">
            <div class="bg-cra-navy h-full transition-all duration-1000" style="width:${pct}%"></div>
          </div>
        </div>`;
      }).join('');

      // 4. ‡∏ï‡∏≤‡∏£‡∏≤‡∏á W ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞
      renderTable('tableW', getCounts(data, 22, true), total, ['‡πÅ‡∏´‡∏•‡πà‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏≤', '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô', '‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞']);

      // 5. ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó (Y, Z, AD, AE)
      const compData = combineColumns(data, [24, 25, 29, 30]);
      renderTable('tableCompany', compData, ['‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à', '‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞'], 10);

      // 6. ‡∏™‡∏õ‡∏≠‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå (AA, AF)
      const sponData = combineColumns(data, [26, 31]);
      renderTable('tableSponsor', sponData, ['‡∏ö‡∏π‡∏ò‡∏™‡∏õ‡∏≠‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå', '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô', '‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞'], 5);

      // 7. ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞
      const suggestions = [...new Set(data.map(r => r[28] || r[33]))].filter(x => x && x.length > 3);
      document.getElementById('listSuggest').innerHTML = suggestions.map(s => `<div class="bg-white/10 p-4 rounded-2xl border border-white/10 text-sm">"${s}"</div>`).join('');
    }

    // Helper Functions
    function getAvg(data, idx) {
      const vals = data.map(r => parseFloat(r[idx])).filter(v => !isNaN(v));
      return vals.length ? (vals.reduce((a,b)=>a+b, 0)/vals.length).toFixed(2) : "0.00";
    }

    function getCounts(data, idx, isMulti = false) {
      let c = {};
      data.forEach(r => {
        let items = isMulti ? (r[idx]||"").split(/,\s*/) : [r[idx]];
        items.forEach(it => { if(it && it.trim() !== "" && it !== "-") c[it.trim()] = (c[it.trim()]||0)+1; });
      });
      return Object.entries(c).sort((a,b) => b[1]-a[1]);
    }

    function combineColumns(data, indices) {
      let c = {};
      data.forEach(r => indices.forEach(idx => {
        let v = r[idx]?.trim();
        if(v && v !== "" && v !== "-") c[v] = (c[v]||0)+1;
      }));
      return Object.entries(c).sort((a,b) => b[1]-a[1]);
    }

    function renderTable(id, counts, total, headers, limit = 99) {
      const items = counts.slice(0, limit);
      document.getElementById(id).innerHTML = `
        <table class="w-full text-sm">
          <thead><tr class="text-slate-400 border-b"><th class="py-3 text-left">${headers[0]}</th><th class="text-right">${headers[1]}</th><th class="text-right">${headers[2]}</th></tr></thead>
          <tbody>${items.map(it => `
            <tr class="border-b hover:bg-slate-50 transition">
              <td class="py-3 font-medium">${it[0]}</td>
              <td class="text-right font-bold text-cra-navy">${it[1]}</td>
              <td class="text-right text-slate-400 font-bold">${((it[1]/total)*100).toFixed(1)}%</td>
            </tr>`).join('')}
          </tbody>
        </table>`;
    }

    function renderChart(id, type, counts, total) {
      if(activeCharts[id]) activeCharts[id].destroy();
      activeCharts[id] = new Chart(document.getElementById(id), {
        type: type,
        data: {
          labels: counts.map(c => c[0]),
          datasets: [{ data: counts.map(c => c[1]), backgroundColor: ['#0F2C67','#E65100','#3b82f6','#10b981','#f59e0b'] }]
        },
        options: {
          maintainAspectRatio: false,
          indexAxis: 'y',
          plugins: {
            legend: { display: false },
            datalabels: {
              anchor: 'end', align: 'right', color: '#64748b', font: { weight: 'bold' },
              formatter: (v) => `${((v/total)*100).toFixed(1)}%`
            }
          },
          scales: { x: { display: false }, y: { grid: { display: false } } }
        }
      });
    }
  </script>
</body>
</html>
